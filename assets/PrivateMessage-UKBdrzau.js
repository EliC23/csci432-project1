import{_ as $,r,o as B,c,a as t,b as z,w as A,H as E,t as u,u as x,d as V,e as j,F as D,f as O,g as U,v as H,h as P,n as T,i as d,j as R,k as F}from"./index-uMiL5DxZ.js";const L={class:"private-message-container"},q={class:"header-wrapper"},G={class:"chat-title"},J={key:0,class:"feedback-popup"},Y={class:"message-sender"},K={class:"message-text"},Q={class:"message-time"},W={class:"message-input"},X={__name:"PrivateMessage",setup(Z){const h=P(),I=F(),n=r([]),l=r(""),_=r(""),k=h.params.userId,M=h.query.name||"User",p=r(localStorage.getItem("userId")||""),b=r(localStorage.getItem("userName")||"You"),v=localStorage.getItem("token"),i=r(null),f=r(null),m=r(!1);async function g(a=null,e=5){if(!v)return;let s=`https://hap-app-api.azurewebsites.net/messages/${k}?limit=${e}`;a&&(s+=`&before=${a}`);try{const o=await fetch(s,{method:"GET",headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"}});if(o.ok){const w=await o.json();a?n.value.unshift(...w.reverse()):n.value=w.reverse(),n.value.length>0&&(f.value=n.value[0].updatedAt),T(()=>{a||y()})}}catch(o){console.error("Error fetching messages:",o)}}function y(){T(()=>{i.value&&(i.value.scrollTop=i.value.scrollHeight)})}async function C(){if(!i.value||m.value)return;const{scrollTop:a}=i.value;a<=10&&f.value&&(m.value=!0,await g(f.value),m.value=!1)}async function S(){if(!l.value.trim())return;const a={senderId:p.value,senderName:b.value,text:l.value.trim(),updatedAt:new Date().toISOString()};n.value.push(a);const e=`https://hap-app-api.azurewebsites.net/message/${k}`,s={text:l.value.trim()};try{const o=await fetch(e,{method:"POST",headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"},body:JSON.stringify(s)});o.ok?console.log("Message sent!"):console.error("Error sending message:",o.statusText)}catch(o){console.error("Error:",o)}l.value="",y()}async function N(){n.value=[],g()}return B(()=>{g()}),(a,e)=>(d(),c("div",L,[t("div",q,[z(E,null,{default:A(()=>[t("button",{class:"close-btn",onClick:e[0]||(e[0]=s=>x(I).back())},e[2]||(e[2]=[t("i",{class:"fa-solid fa-xmark"},null,-1)]))]),_:1})]),t("h2",G,"Chat with "+u(x(M)),1),_.value?(d(),c("div",J,u(_.value),1)):V("",!0),t("button",{class:"refresh-btn",onClick:N},e[3]||(e[3]=[t("i",{class:"fa-solid fa-arrows-rotate"},null,-1),j(" Refresh ")])),t("div",{class:"messages-container",ref_key:"scrollContainer",ref:i,onScroll:C},[(d(!0),c(D,null,O(n.value,s=>(d(),c("div",{key:s.messageId,class:R({message:!0,"message-sent":s.senderId===p.value,"message-received":s.senderId!==p.value})},[t("p",Y,u(s.senderName),1),t("p",K,u(s.text),1),t("p",Q,u(new Date(s.updatedAt).toLocaleString()),1)],2))),128))],544),t("div",W,[U(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=s=>l.value=s),placeholder:"Type a message..."},null,512),[[H,l.value]]),t("button",{onClick:S},e[4]||(e[4]=[t("i",{class:"fa-solid fa-paper-plane"},null,-1)]))])]))}},se=$(X,[["__scopeId","data-v-b7e06989"]]);export{se as default};
